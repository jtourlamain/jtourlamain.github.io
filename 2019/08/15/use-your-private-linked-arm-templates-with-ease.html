<!doctype html>

<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/assets/images/favicon.ico">
	<title>Use your private linked ARM templates with ease – DevProtocol</title>
	<meta name="description" content="">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Use your private linked ARM templates with ease – DevProtocol">
	<meta name="twitter:description" content="">
	<meta name="twitter:image:src" content="http://0.0.0.0:4000">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="Use your private linked ARM templates with ease – DevProtocol" />
	<meta property="og:description" content="" />
	<meta property="og:image" content="http://0.0.0.0:4000" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
	

	<!-- Styles -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400%7CRoboto+Slab' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="/assets/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/screen.css">

	<link rel="alternate" type="application/rss+xml"  href="http://0.0.0.0:4000/feed.xml" title="DevProtocol">

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="home-template">


	<header class="main-header">
	<div class="container">
		<div class="row">
		<div class="col-sm-12">
			<a class="branding" href="/"><span class="mylogo">Dev</span>Protocol</a>
		</div>
		</div>
	</div>
</header>

<nav class="main-navigation">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				<div class="navbar-header">
					<span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu">
					<span class="sr-only">Toggle navigation</span>
					<i class="fa fa-bars"></i>
					</span>
				</div>
				<div class="collapse navbar-collapse" id="main-menu">
					<ul class="menu">
						
						<li class="nav-home" role="presentation"><a href="/">Home</a></li>
						
						<li class="nav-home" role="presentation"><a href="/about">About</a></li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</nav>


	<section class="content-wrap">

		<div class="container">
			<div class="row">
				<div class="col-md-8 main-content">

					<article class="post">
	<div class="post-head">
		<h2 class="post-title">Use your private linked ARM templates with ease</h2>
		<div class="post-meta">
			
			<span class="author">By <a href="">Jan Tourlamain</a></span> &bull;
			
			<span class="date">August 15, 2019</span> &bull;
			<span class="comment-count"><a href="#disqus_thread">0 Comments</a></span>
		</div>
	</div>
	
	<div class="featured-media">
		<img src="/assets/images/2019/08/arm.png" alt="Use your private linked ARM templates with ease">
	</div>
	
	<div class="post-content">
		<p>Everyone that worked with ARM templates knows that they are error prone. More often than not it’s a struggle get them right. So, if you don’t want your team to wonder if that 6th floor window isn’t an easier way out, you provide them reusable templates. One problem with linked templates is that they must be publicly available. As not all companies want their resources be publicly exposed, you need to find another way.</p>

<p>As you want to use ARM templates, I assume you’re already working with Azure. It’s kind of logical you want to store your ARM templates in Azure as well.</p>

<h2 id="put-your-arm-templates-in-azure-storage">Put your ARM templates in Azure storage</h2>

<p>Create an Azure storage account. Create a blob container and make sure you set the “Public access level” to “Private (no anonymous access)</p>

<p><img src="/assets/images/2019/08/linkedArmtemplates00.png" alt="private blob" /></p>

<p>Once the container is created you can upload all your reusable ARM templates. <a href="/2019/05/10/arm-your-devpipe-with-calm.html">In a previous post you can verify how I set up reusable and linked templates</a>.</p>

<h2 id="inject-a-sas-token-in-your-azure-devops-pipeline">Inject a SAS token in your Azure DevOps pipeline</h2>

<p>To access the private blob files, you can use a SAS token. A SAS token can be generated for your CD pipeline by adding a simple Azure Powershell script:</p>

<pre><code class="language-ps1">Set-AzCurrentStorageAccount -ResourceGroupName "&lt;name-of-your-resource-group&gt;" -Name "&lt;name-of-your-storage-account&gt;"
$token = New-AzStorageContainerSASToken -Name "&lt;name-of-the-private-blob-container&gt;" -Permission r -ExpiryTime (Get-Date).AddMinutes(30.0)
Write-Host ("##vso[task.setvariable variable=infra_armTemplateToken;issecret=true;]$token")
</code></pre>

<p>The script generates a token and inject the variable <strong>$(infra_armTemplateToken)</strong> in your DevOps pipeline so you can use it in your ARM deployment task.
Notice that the token is only valid for 30 minutes. 
Please note that your Service Principle (used by your Azure DevOps) needs to have access on the resource group where the storage account lives.</p>

<p>If you get the error
<em>[error]The term ‘Set-AzCurrentStorageAccount’ is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.</em> 
You can solve it by using the Azure Powershell Task version 4 (currently in preview)</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-linked-templates#securing-an-external-template">https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-linked-templates#securing-an-external-template</a></li>
</ul>

	</div>
	<footer class="post-footer clearfix">
		<div class="pull-left tag-list">
			<i class="fa fa-folder-open-o"></i>
			
			
				
				<a href="/tag/alm/">alm</a>, 
				
			
				
				<a href="/tag/azure/">azure</a>, 
				
			
				
				<a href="/tag/devops/">devops</a>
				
			
		</div>

	</footer>
</article>
<div class="comment-wrap">
	
<div class="disqus-container">
    <div id="disqus_thread"></div>
    <script>
        /**
        *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
        /*
        var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        */
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://devprotocol.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</div>



				</div>

				<div class="col-md-4 sidebar">
        <div class="widget">
        <h4 class="title">Follow</h4>
        <div class="content">
            <ul class="social">
                <!-- start social links -->
                <li><a href="https://be.linkedin.com/in/jantourlamain"><i class="fa fa-linkedin"></i></a></li>
                <li><a href="https://github.com/jtourlamain"><i class="fa fa-github"></i></a></li>
                <li><a href="/feed.xml"><i class="fa fa-rss"></i></a></li>
                <!-- end social links -->
            </ul>
        </div>
    </div>
    <div class="widget">
    <h4 class="title">Recent Post</h4>
	<div class="content recent-post">
        
    <div class="recent-single-post">
      <a href="/2020/01/28/use-policy-expressions-with-named-values-in-azure-api-management.html" class="post-title">Use policy expressions with named values in Azure API management</a>
      <div class="date">January 28, 2020</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/15/use-your-private-linked-arm-templates-with-ease.html" class="post-title">Use your private linked ARM templates with ease</a>
      <div class="date">August 15, 2019</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/12/application-insights-setup-for-dotnet-core-2-1.html" class="post-title">Application Insights setup for dotnet core 2.1</a>
      <div class="date">August 12, 2019</div>
      </div>
      
  </div>
</div>
	    <div class="widget">
        <h4 class="title">Tags</h4>
        <div class="content tag-cloud">
            
            
            <a href="/tag/alm/">alm</a>
            
            <a href="/tag/azure/">azure</a>
            
            <a href="/tag/devops/">devops</a>
            
            <a href="/tag/docker/">docker</a>
            
            <a href="/tag/dotnet/">dotnet</a>
            
            <a href="/tag/fsharp/">fsharp</a>
            
            <a href="/tag/giraffe/">giraffe</a>
            
            <a href="/tag/mobile/">mobile</a>
            
            <a href="/tag/o365/">o365</a>
            
            <a href="/tag/oauth2/">oauth2</a>
            
            <a href="/tag/other/">other</a>
            
            <a href="/tag/powershell/">powershell</a>
            
            <a href="/tag/productivity/">productivity</a>
            
            <a href="/tag/reactiveui/">reactiveui</a>
            
            <a href="/tag/xamarin/">xamarin</a>
            
        </div>
    </div>
</div>

			</div>
		</div>
	</section>


	<footer class="main-footer">

	<div class="container">
		<div class="row">
			<div class="col-sm-4">
				<div class="widget">
    <h4 class="title">Recent Post</h4>
	<div class="content recent-post">
        
    <div class="recent-single-post">
      <a href="/2020/01/28/use-policy-expressions-with-named-values-in-azure-api-management.html" class="post-title">Use policy expressions with named values in Azure API management</a>
      <div class="date">January 28, 2020</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/15/use-your-private-linked-arm-templates-with-ease.html" class="post-title">Use your private linked ARM templates with ease</a>
      <div class="date">August 15, 2019</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/12/application-insights-setup-for-dotnet-core-2-1.html" class="post-title">Application Insights setup for dotnet core 2.1</a>
      <div class="date">August 12, 2019</div>
      </div>
      
  </div>
</div>
			</div>
			<div class="col-sm-4">
				    <div class="widget">
        <h4 class="title">Tags</h4>
        <div class="content tag-cloud">
            
            
            <a href="/tag/alm/">alm</a>
            
            <a href="/tag/azure/">azure</a>
            
            <a href="/tag/devops/">devops</a>
            
            <a href="/tag/docker/">docker</a>
            
            <a href="/tag/dotnet/">dotnet</a>
            
            <a href="/tag/fsharp/">fsharp</a>
            
            <a href="/tag/giraffe/">giraffe</a>
            
            <a href="/tag/mobile/">mobile</a>
            
            <a href="/tag/o365/">o365</a>
            
            <a href="/tag/oauth2/">oauth2</a>
            
            <a href="/tag/other/">other</a>
            
            <a href="/tag/powershell/">powershell</a>
            
            <a href="/tag/productivity/">productivity</a>
            
            <a href="/tag/reactiveui/">reactiveui</a>
            
            <a href="/tag/xamarin/">xamarin</a>
            
        </div>
    </div>
			</div>
			<div class="col-sm-4">
				&nbsp;
			</div>
			
		
		</div>
	</div>

</footer>


<div class="copyright">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				Copyright &copy; 2021, <a href="http://0.0.0.0:4000">DevProtocol</a>.  All Right Reserved
			</div>
		</div>
	</div>
</div>
<a href="#" id="back-to-top"><i class="fa fa-angle-up"></i></a>


	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>