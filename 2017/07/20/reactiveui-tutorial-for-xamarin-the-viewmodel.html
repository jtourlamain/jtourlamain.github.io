<!doctype html>

<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/assets/images/favicon.ico">
	<title>ReactiveUI Tutorial for Xamarin: The ViewModel – DevProtocol</title>
	<meta name="description" content="">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="ReactiveUI Tutorial for Xamarin: The ViewModel – DevProtocol">
	<meta name="twitter:description" content="">
	<meta name="twitter:image:src" content="https://www.devprotocol.com">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="ReactiveUI Tutorial for Xamarin: The ViewModel – DevProtocol" />
	<meta property="og:description" content="" />
	<meta property="og:image" content="https://www.devprotocol.com" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
	

	<!-- Styles -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400%7CRoboto+Slab' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="/assets/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/screen.css">

	<link rel="alternate" type="application/rss+xml"  href="https://www.devprotocol.com/feed.xml" title="DevProtocol">

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="home-template">


	<header class="main-header">
	<div class="container">
		<div class="row">
		<div class="col-sm-12">
			<a class="branding" href="/"><span class="mylogo">Dev</span>Protocol</a>
		</div>
		</div>
	</div>
</header>

<nav class="main-navigation">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				<div class="navbar-header">
					<span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu">
					<span class="sr-only">Toggle navigation</span>
					<i class="fa fa-bars"></i>
					</span>
				</div>
				<div class="collapse navbar-collapse" id="main-menu">
					<ul class="menu">
						
						<li class="nav-home" role="presentation"><a href="/">Home</a></li>
						
						<li class="nav-home" role="presentation"><a href="/about">About</a></li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</nav>


	<section class="content-wrap">

		<div class="container">
			<div class="row">
				<div class="col-md-8 main-content">

					<article class="post">
	<div class="post-head">
		<h2 class="post-title">ReactiveUI Tutorial for Xamarin: The ViewModel</h2>
		<div class="post-meta">
			
			<span class="author">By <a href="">Jan Tourlamain</a></span> &bull;
			
			<span class="date">July 20, 2017</span> &bull;
			<span class="comment-count"><a href="#disqus_thread">0 Comments</a></span>
		</div>
	</div>
	
	<div class="featured-media">
		<img src="/assets/images/2017/07/marbles.png" alt="ReactiveUI Tutorial for Xamarin: The ViewModel">
	</div>
	
	<div class="post-content">
		<h2 id="introduction">Introduction</h2>

<p>The documentation about ReactiveUI is getting better, but sometimes another point of view can make the click in your head. It took me a while before I could get my head around ReactiveUI. One of the reasons was that I couldn’t find my way in the framework.  I already wrote a post about ReactiveUI cf <a href="/2016/07/06/getting-started-with-xamarin-forms-and-reactiveui.html">Getting started with Xamarin Forms and ReactiveUI</a>, but I didn’t go into much details. With this post I hope to give you a better understanding of the framework.</p>

<p>ReactiveUI isn’t an all or nothing framework. It can help you out with small things. ReactiveUI can be used with Xamarin.Android, Xamarin.iOS and Xamarin.Forms. Although Xamarin.iOS and Xamarin.Android don’t have the binding concept out of the box, ReactiveUI lets you define it via code (MVVMCross does it as well).</p>

<h2 id="the-beginning">The beginning</h2>

<p>In this tutorial we start small and use ReactiveUI only in our ViewModel. A ViewModel contains 2 basic concepts:</p>

<ul>
  <li>Bindable properties</li>
  <li>Commands</li>
</ul>

<p>This blogpost is all about taming those two concepts in ReactiveUI.</p>

<h2 id="meet-swapirui">Meet SwapiRui</h2>

<p>Last I discovered a public REST API with Star Wars info. I’ll be using that API to work with some data. The API can be found on <a href="http://swapi.co/">SWAPI - The Star Wars API</a>. A mix of that API with ReactiveUI simply became SwapiRui.</p>

<h2 id="setup-xforms-solution">Setup XForms solution</h2>

<p>To force using the MVVM pattern, I’ve created a UI project which will contain all our views and a Core project which will contain our logic/viewmodels.
The UI project can have a reference to the Core project because views may know about the viewmodels (the other way around is not true).</p>

<h2 id="default-xamarin-way-of-bindings">Default Xamarin way of bindings</h2>

<p>We’ll create an easy page to recap how we use to bind our views to our viewmodels.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ContentPage.Content&gt;</span>
    <span class="nt">&lt;StackLayout</span> <span class="na">HorizontalOptions=</span><span class="s">"CenterAndExpand"</span> 
			<span class="na">VerticalOptions=</span><span class="s">"CenterAndExpand"</span> 
			<span class="na">Padding=</span><span class="s">"30"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Grid&gt;</span>
            <span class="nt">&lt;Grid.ColumnDefinitions&gt;</span>
                <span class="nt">&lt;ColumnDefinition</span> <span class="na">Width=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;ColumnDefinition</span> <span class="na">Width=</span><span class="s">"2*"</span> <span class="nt">/&gt;</span>
		      <span class="nt">&lt;/Grid.ColumnDefinitions&gt;</span>
            <span class="nt">&lt;Grid.RowDefinitions&gt;</span>
               <span class="nt">&lt;RowDefinition</span> <span class="na">Height=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;RowDefinition</span> <span class="na">Height=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;RowDefinition</span> <span class="na">Height=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;RowDefinition</span> <span class="na">Height=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
               <span class="nt">&lt;RowDefinition</span> <span class="na">Height=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
		      <span class="nt">&lt;/Grid.RowDefinitions&gt;</span>

            <span class="nt">&lt;Label</span> <span class="na">Text=</span><span class="s">"FirstName"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;Entry</span> <span class="na">Text=</span><span class="s">"{Binding FirstName}"</span> <span class="na">Grid.Column=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;Label</span> <span class="na">Text=</span><span class="s">"LastName"</span> <span class="na">Grid.Row=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;Entry</span> <span class="na">Text=</span><span class="s">"{Binding LastName}"</span> <span class="na">Grid.Row=</span><span class="s">"1"</span> <span class="na">Grid.Column=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

				<span class="nt">&lt;Label</span> <span class="na">Text=</span><span class="s">"{Binding FullName}"</span> <span class="na">Grid.Row=</span><span class="s">"2"</span> <span class="na">Grid.Column=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;Button</span> <span class="na">Command=</span><span class="s">"{Binding SaveCommand}"</span> <span class="na">Text=</span><span class="s">"Save"</span> <span class="na">Grid.Row=</span><span class="s">"3"</span> <span class="na">Grid.ColumnSpan=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;Label</span> <span class="na">Text=</span><span class="s">"{Binding Result}"</span> <span class="na">Grid.Row=</span><span class="s">"4"</span> <span class="na">Grid.ColumnSpan=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/Grid&gt;</span>
    <span class="nt">&lt;/StackLayout&gt;</span>
<span class="nt">&lt;/ContentPage.Content&gt;</span>
</code></pre></div></div>

<p>The goal is very simple: provide a first name and a last name. When you click on the button you get a message with “Saved firstname lastname”</p>

<p>In the code behind we just need to set the BindingContext to our ViewModel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">OldPage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="n">BindingContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OldViewModel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Our OldViewModel needs to implement the INotifyPropertyChanged interface so our Views can get notified when something changes in our ViewModel.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span> <span class="p">=</span> <span class="k">delegate</span> <span class="p">{</span> <span class="p">};</span>
<span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">([</span><span class="n">CallerMemberName</span><span class="p">]</span> <span class="kt">string</span> <span class="n">propertyName</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">PropertyChanged</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="nf">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we can set up our FirstName, LastName and Result property in a way we notify subscribers when the value is changed</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kt">string</span> <span class="n">firstName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">firstName</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EqualityComparer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">firstName</span><span class="p">,</span> <span class="k">value</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">firstName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="nf">OnPropertyChanged</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">string</span> <span class="n">lastName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lastName</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EqualityComparer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">lastName</span><span class="p">,</span> <span class="k">value</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">lastName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="nf">OnPropertyChanged</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">Result</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">result</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EqualityComparer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="k">value</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">result</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="nf">OnPropertyChanged</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can bind our button via a command. To make use of commands we need to reference to the Xamarin.Forms lib. Although we avoided referencing our views by splitting the UI in another project, now we need to reference Xamarin.Forms (which contains a lot of views). It doesn’t feel really wrong, but it doesn’t feel good either.</p>

<p>The command implementation in the OldViewModel looks like:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="n">ICommand</span> <span class="n">saveCommand</span><span class="p">;</span>
<span class="k">public</span> <span class="n">ICommand</span> <span class="n">SaveCommand</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">saveCommand</span> <span class="p">??</span> <span class="p">(</span><span class="n">saveCommand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Command</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nf">ExecuteSaveCommand</span><span class="p">()));</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">ExecuteSaveCommand</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Result</span> <span class="p">=</span> <span class="s">$"Saved </span><span class="p">{</span><span class="n">FirstName</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">LastName</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="facing-complexity-where-things-should-be-easy">Facing complexity where things should be easy</h3>

<p>Say you want to visualise the FullName of the person. How can we set the Result directly? Well, you need to update the Result when changing the FirstName or LastName</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kt">string</span> <span class="n">firstName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">firstName</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EqualityComparer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">firstName</span><span class="p">,</span> <span class="k">value</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">firstName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="nf">OnPropertyChanged</span><span class="p">();</span>
        <span class="n">Result</span> <span class="p">=</span> <span class="n">FirstName</span> <span class="p">+</span> <span class="s">" "</span> <span class="p">+</span> <span class="n">LastName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">string</span> <span class="n">lastName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lastName</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">EqualityComparer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">lastName</span><span class="p">,</span> <span class="k">value</span><span class="p">))</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="n">lastName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="nf">OnPropertyChanged</span><span class="p">();</span>
        <span class="n">Result</span> <span class="p">=</span> <span class="n">FirstName</span> <span class="p">+</span> <span class="s">" "</span> <span class="p">+</span> <span class="n">LastName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Yes, you can also create a method to update the Result, but the problem stays the same: you’ll face complexity very fast. And it’s kind of ugly to change the code in your properties to describe what needs to happen. And if you thing about the checks you need to implement to verify if the user may click on the button, you better start writing some unit tests.</p>

<h2 id="meet-reactiveui">Meet ReactiveUI</h2>

<p>ReactiveUI is a framework that can help us out with writing our code in a more declarative way.  So what does that mean? Well, you write your statements in such a way that you tell  what you want to achieve as a result. So it’s less about how you want it to be done (=imperative style).
For all this, ReactiveUI makes use of Reactive Extensions (Rx).</p>

<h3 id="reactiveui-vs-reactive-extensions">ReactiveUI vs Reactive Extensions</h3>

<p>Can’t we just use Rx? You can, but when creating UI apps ReactiveUI makes it easier to use Rx.  ReactiveUI provides a lot of helper methods and easy ways to combine your UI and UI logic with observables. 
For example: with default Rx, you can’t just bind to an Observable, but with ReactiveUI it becomes simple.</p>

<h3 id="getting-started">Getting started</h3>

<p>To start with ReactiveUI we’ll rework the example above and use RxUI instead of the default Xamarin implementation.
First add the ReactiveUI NuGet package to your projects.</p>

<p>I’ve created a PersonPage that is exactly the same as the OldPage. Only in the code behind the binding context is set to a PersonViewModel</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">PersonPage</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="n">BindingContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PersonViewModel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="reactiveobject">ReactiveObject</h3>

<p>ReactiveObject is a base class for your ViewModels.
The PersonViewModel doesn’t implement the INotifyPropertyChanged interface but inherits from ReactiveObject.
ReactiveObject gives you a nice way to implement a property and let subscribers know that the property was changed</p>

<p>In RxUI you make a distinction between read-only properties and read-write properties.</p>

<h4 id="read-write-property">Read-write property</h4>

<p>Our FirstName and LastName are read-write properties. When the property is set we call the RxUI RaiseAndSetIfChanged method. Behind the scenes RxUI backs your property with an observable. That means that every change on your property is an event in a sequence.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kt">string</span> <span class="n">firstName</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">firstName</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nf">RaiseAndSetIfChanged</span><span class="p">(</span><span class="k">ref</span> <span class="n">firstName</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="read-only-property--output-property">Read-only property (= output property)</h4>

<p>Unique to the RxUI framework is a readonly property. When working with Rx you end up using observables. But observables aren’t properties you can bind to. With an output property you can take an observable and make it appear like a property. As a result, when you access the property you get the last value that fired of the observable. So it is like a Rx behavior subject  that holds on to the latest value and wraps it in a property.</p>

<p>What we want is that the FullName appears in a label as we type the FirstName and LastName.  When typing the FirstName, we get an event with each character we type. It’s a stream of events. The same is true for LastName. So what we want is combine those two streams into a new stream and output the new stream into our FullName property.</p>

<p>Our read-only property looks like:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">readonly</span> <span class="n">ObservableAsPropertyHelper</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">fullName</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">FullName</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fullName</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we need to create an observable that listens to the changes of our FirstName and LastName property. ReactiveUI helps you out with WhenAnyValue (it becomes available when inheriting from ReactiveObject)</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">PersonViewModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">fullName</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">WhenAnyValue</span><span class="p">(</span><span class="n">vm</span> <span class="p">=&gt;</span> <span class="n">vm</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
				          <span class="n">vm</span> <span class="p">=&gt;</span> <span class="n">vm</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
			              <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="s">$"</span><span class="p">{</span><span class="n">first</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">last</span><span class="p">}</span><span class="s">"</span><span class="p">)</span>
			          <span class="p">.</span><span class="nf">ToProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">vm</span> <span class="p">=&gt;</span> <span class="n">vm</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="k">out</span> <span class="n">fullName</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>vm =&gt; vm.FirstName takes the FirstName property of our ViewModel</li>
  <li>vm =&gt; vm.LastName takes the LastName property of our ViewModel</li>
  <li>(first, last) =&gt; $”{first} {last}”) takes the previous two and defines a Func, in our case the first and last name with a space between</li>
  <li>ToProperty transforms the sequence into the output property.</li>
</ul>

<h4 id="the-relationship-between-whenany-and-toproperty">The relationship between WhenAny and ToProperty</h4>

<p>So we’ve seen the use of WhenAny and ToProperty. You can conclude that those two are opposites: WhenAny transforms a property into an observable and ToProperty transforms an observable into a property</p>

<p>The code that setup that relationship will most of the time live in the constructor of your ViewModel.</p>

<h4 id="commands">Commands</h4>

<p>We can bind button clicks to a default ICommand, but ReactiveUI has a smarter implementation called ReactiveCommand.
I you think about what your user does before clicking a button, you know the context is changing constantly. And that is a perfect candidate for an observable of bool. ReactiveCommand uses it to know whether you’re allowed to trigger a command.
ReactiveCommand also helps you with async stuff. If, for example, you call a web service, you don’t want the user to click the button again while your call is still ongoing. With ICommand you can add all kind of IsBusy checks, but if your UI becomes more complex, the IsBusy checks will quickly become a hassle.</p>

<p>A basic  ReactiveCommand is:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">PersonViewModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SaveCommand</span> <span class="p">=</span> <span class="n">ReactiveCommand</span><span class="p">.</span><span class="nf">CreateFromTask</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span>
	  <span class="p">{</span>
	      <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="k">public</span> <span class="n">ReactiveCommand</span><span class="p">&lt;</span><span class="n">Unit</span><span class="p">,</span> <span class="n">Unit</span><span class="p">&gt;</span> <span class="n">SaveCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<p>If you bind it to your button you’ll notice that the Save button will be disabled for 2 seconds. Even more, notice that your UI is still responsive. So ReactiveUI seamlessly swaps between the background thread (where your Task.Delay is executed) and the UI thread.  Like I said, it’s an improved implementation of ICommand.</p>

<p>You can subscribe to a ReactiveCommand and pass in an observer so you get notified every time the command is executed, an error occurred or the observable ends (which won’t happen on a button).  Now if we want to give a message to the user that our name was saved we can subscribe to the ReactiveCommand. This sounds like a good option for a readonly property, don’t you think? Well, we can make use of the ToProperty extension method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">PersonViewModel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SaveCommand</span> <span class="p">=</span> <span class="n">ReactiveCommand</span><span class="p">.</span><span class="nf">CreateFromTask</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="n">SaveCommand</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="s">"Saved on "</span> <span class="p">+</span> <span class="n">x</span><span class="p">.</span><span class="nf">ToString</span><span class="p">()).</span><span class="nf">ToProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">vm</span> <span class="p">=&gt;</span> <span class="n">vm</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="n">ReactiveCommand</span><span class="p">&lt;</span><span class="n">Unit</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">&gt;</span> <span class="n">SaveCommand</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="k">private</span> <span class="k">readonly</span> <span class="n">ObservableAsPropertyHelper</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">;</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">Result</span>
<span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="all-the-power-of-rx">All the power of Rx</h3>

<p>Now we know how to create the observables, we can make use of all the power Rx gives us.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You can get started with ReactiveUI in an easy way.  It’s a matter of transforming your stuff into observables or transform observables into properties or commands. You can use ReactiveUI to describe relationships and as a result work in a more declarative way.</p>

<h2 id="download">Download</h2>

<p>Download the code from <a href="https://github.com/jtourlamain/DevProtocol.Xam.SwapiRui">my GitHub</a>. Checkout the tag ViewModel on the Master branch.</p>


	</div>
	<footer class="post-footer clearfix">
		<div class="pull-left tag-list">
			<i class="fa fa-folder-open-o"></i>
			
			
				
				<a href="/tag/mobile/">mobile</a>, 
				
			
				
				<a href="/tag/reactiveui/">reactiveui</a>, 
				
			
				
				<a href="/tag/xamarin/">xamarin</a>
				
			
		</div>

	</footer>
</article>
<div class="comment-wrap">
	
<div class="disqus-container">
    <div id="disqus_thread"></div>
    <script>
        /**
        *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
        /*
        var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        */
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://devprotocol.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</div>



				</div>

				<div class="col-md-4 sidebar">
        <div class="widget">
        <h4 class="title">Follow</h4>
        <div class="content">
            <ul class="social">
                <!-- start social links -->
                <li><a href="https://be.linkedin.com/in/jantourlamain"><i class="fa fa-linkedin"></i></a></li>
                <li><a href="https://github.com/jtourlamain"><i class="fa fa-github"></i></a></li>
                <li><a href="/feed.xml"><i class="fa fa-rss"></i></a></li>
                <!-- end social links -->
            </ul>
        </div>
    </div>
    <div class="widget">
    <h4 class="title">Recent Post</h4>
	<div class="content recent-post">
        
    <div class="recent-single-post">
      <a href="/2021/07/20/expose-openapi-documentation-on-azure-api-management.html" class="post-title">Expose openapi documentation on Azure API Management</a>
      <div class="date">July 20, 2021</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2020/01/28/use-policy-expressions-with-named-values-in-azure-api-management.html" class="post-title">Use policy expressions with named values in Azure API management</a>
      <div class="date">January 28, 2020</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/15/use-your-private-linked-arm-templates-with-ease.html" class="post-title">Use your private linked ARM templates with ease</a>
      <div class="date">August 15, 2019</div>
      </div>
      
  </div>
</div>
	    <div class="widget">
        <h4 class="title">Tags</h4>
        <div class="content tag-cloud">
            
            
            <a href="/tag/alm/">alm</a>
            
            <a href="/tag/azure/">azure</a>
            
            <a href="/tag/devops/">devops</a>
            
            <a href="/tag/docker/">docker</a>
            
            <a href="/tag/dotnet/">dotnet</a>
            
            <a href="/tag/fsharp/">fsharp</a>
            
            <a href="/tag/giraffe/">giraffe</a>
            
            <a href="/tag/mobile/">mobile</a>
            
            <a href="/tag/o365/">o365</a>
            
            <a href="/tag/oauth2/">oauth2</a>
            
            <a href="/tag/other/">other</a>
            
            <a href="/tag/powershell/">powershell</a>
            
            <a href="/tag/productivity/">productivity</a>
            
            <a href="/tag/reactiveui/">reactiveui</a>
            
            <a href="/tag/xamarin/">xamarin</a>
            
        </div>
    </div>
</div>

			</div>
		</div>
	</section>


	<footer class="main-footer">

	<div class="container">
		<div class="row">
			<div class="col-sm-4">
				<div class="widget">
    <h4 class="title">Recent Post</h4>
	<div class="content recent-post">
        
    <div class="recent-single-post">
      <a href="/2021/07/20/expose-openapi-documentation-on-azure-api-management.html" class="post-title">Expose openapi documentation on Azure API Management</a>
      <div class="date">July 20, 2021</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2020/01/28/use-policy-expressions-with-named-values-in-azure-api-management.html" class="post-title">Use policy expressions with named values in Azure API management</a>
      <div class="date">January 28, 2020</div>
      </div>
      
    <div class="recent-single-post">
      <a href="/2019/08/15/use-your-private-linked-arm-templates-with-ease.html" class="post-title">Use your private linked ARM templates with ease</a>
      <div class="date">August 15, 2019</div>
      </div>
      
  </div>
</div>
			</div>
			<div class="col-sm-4">
				    <div class="widget">
        <h4 class="title">Tags</h4>
        <div class="content tag-cloud">
            
            
            <a href="/tag/alm/">alm</a>
            
            <a href="/tag/azure/">azure</a>
            
            <a href="/tag/devops/">devops</a>
            
            <a href="/tag/docker/">docker</a>
            
            <a href="/tag/dotnet/">dotnet</a>
            
            <a href="/tag/fsharp/">fsharp</a>
            
            <a href="/tag/giraffe/">giraffe</a>
            
            <a href="/tag/mobile/">mobile</a>
            
            <a href="/tag/o365/">o365</a>
            
            <a href="/tag/oauth2/">oauth2</a>
            
            <a href="/tag/other/">other</a>
            
            <a href="/tag/powershell/">powershell</a>
            
            <a href="/tag/productivity/">productivity</a>
            
            <a href="/tag/reactiveui/">reactiveui</a>
            
            <a href="/tag/xamarin/">xamarin</a>
            
        </div>
    </div>
			</div>
			<div class="col-sm-4">
				&nbsp;
			</div>
			
		
		</div>
	</div>

</footer>


<div class="copyright">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				Copyright &copy; 2021, <a href="https://www.devprotocol.com">DevProtocol</a>.  All Right Reserved
			</div>
		</div>
	</div>
</div>
<a href="#" id="back-to-top"><i class="fa fa-angle-up"></i></a>


	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>